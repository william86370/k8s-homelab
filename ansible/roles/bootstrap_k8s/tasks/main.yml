---
- name: Check if the cluster is already Bootstraped 
  stat:
    path: "/etc/kubernetes/.kubeadm_initialized"
  register: kubeadm_initialized

- name: Bootstrap the Kubernetes control plane
  include_tasks: bootstrap.yml
  when: not kubeadm_initialized.stat.exists

- name: Fetch kubeconfig from the remote host
  fetch:
    src: "/etc/kubernetes/admin.conf"
    dest: "./kubeconfig.yaml"
    flat: yes
  when: kubeadm_initialized.stat.exists